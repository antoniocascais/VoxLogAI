<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxLogAI - Transcription & OCR</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --primary-bg: #f1f8e9;
            --primary-bg-hover: #e8f5e9;
            --gray-light: #f5f5f5;
            --gray: #e0e0e0;
            --gray-dark: #757575;
            --text-dark: #333333;
            --text-light: #ffffff;
            --error: #d32f2f;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--gray-light);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .hero {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: var(--text-light);
            padding: 2.5rem 0 4rem;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: -2rem;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            max-width: 960px;
            margin: 0 auto 2rem;
            padding: 0 20px;
            position: relative;
            transform: translateY(-2rem);
        }
        
        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
            border-top: 4px solid var(--primary);
        }
        
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .card-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .upload-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            background-color: var(--primary-bg);
            border: 2px dashed var(--primary-light);
            border-radius: var(--radius-sm);
            transition: var(--transition);
            text-align: center;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            background-color: var(--primary-bg-hover);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            margin-bottom: 1rem;
        }
        
        .upload-text h3 {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .upload-text p {
            color: var(--gray-dark);
            font-size: 0.95rem;
        }
        
        .file-limit {
            font-size: 0.85rem;
            color: var(--gray-dark);
            margin-top: 0.25rem;
            font-weight: 500;
        }
        
        .format-badges {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        /* Mode Selector */
        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background-color: var(--gray-light);
            border-radius: var(--radius-sm);
        }
        
        .mode-option {
            padding: 0.8rem 1.2rem;
            font-weight: 500;
            cursor: pointer;
            color: var(--gray-dark);
            border-radius: var(--radius-sm);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            justify-content: center;
            max-width: 250px;
        }
        
        .mode-option:hover {
            background-color: var(--gray);
        }
        
        .mode-option.active {
            color: white;
            background-color: var(--primary);
        }
        
        /* Tab styles */
        .tabs {
            margin-bottom: 1.5rem;
        }
        
        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--gray);
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.8rem 1.2rem;
            font-weight: 500;
            cursor: pointer;
            color: var(--gray-dark);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }
        
        .tab-content {
            position: relative;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* Image upload styles */
        .image-upload-container {
            padding: 2rem;
            background-color: rgba(0, 128, 128, 0.05);
            border: 2px dashed rgba(0, 128, 128, 0.3);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
        }
        
        .image-icon {
            font-size: 3rem;
            color: teal;
            margin-bottom: 1rem;
        }
        
        /* PDF upload styles */
        .pdf-upload-container {
            padding: 2rem;
            background-color: rgba(220, 53, 69, 0.05);
            border: 2px dashed rgba(220, 53, 69, 0.3);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
        }
        
        .pdf-icon {
            font-size: 3rem;
            color: #dc3545;
            margin-bottom: 1rem;
        }
        
        /* YouTube styles */
        .youtube-input-container {
            padding: 2rem;
            background-color: rgba(255, 0, 0, 0.05);
            border: 2px dashed rgba(255, 0, 0, 0.3);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .youtube-icon {
            font-size: 3rem;
            color: #FF0000;
            margin-bottom: 1rem;
        }
        
        .youtube-text {
            margin-bottom: 1.5rem;
        }
        
        .youtube-text h3 {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .youtube-text p {
            color: var(--gray-dark);
            font-size: 0.95rem;
        }
        
        .youtube-input-wrapper {
            width: 100%;
            max-width: 500px;
        }
        
        .youtube-url-input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .youtube-url-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }

        .youtube-text p.small-text {
            font-size: 0.65em;
        }
        
        .format-badge {
            background-color: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            width: 100%;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 140px;
        }
        
        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        button:disabled {
            background-color: var(--gray-dark);
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .file-info {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background-color: white;
            border-radius: var(--radius-sm);
            padding: 0.8rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            font-size: 0.9rem;
        }
        
        .file-info i {
            color: var(--primary);
        }
        
        .status {
            margin-top: 1rem;
            font-weight: 500;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .result-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 0;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .result-header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-header h2 {
            font-size: 1.2rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .result-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .action-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
            min-width: auto;
            box-shadow: none;
        }
        
        .action-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(0);
            box-shadow: none;
        }
        
        .action-button:disabled {
            opacity: 0.5;
            background-color: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
        }
        
        .copied-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            top: -30px;
            right: 0;
            animation: fadeOut 1.5s forwards;
            pointer-events: none;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .result-content {
            padding: 1.5rem;
            min-height: 300px;
            line-height: 1.8;
            font-size: 1.05rem;
            white-space: pre-wrap;
            color: var(--text-dark);
            background-color: #fcfcfc;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 1rem;
            height: 1rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .error {
            color: var(--error);
            margin-top: 1rem;
            background-color: rgba(211, 47, 47, 0.1);
            padding: 0.8rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .placeholder-text {
            color: var(--gray-dark);
            font-style: italic;
        }
        
        .options-container {
            margin-top: 1rem;
        }
        
        .toggle-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }
        
        .toggle-label {
            font-size: 0.85rem;
            color: var(--gray-dark);
            font-weight: 500;
        }
        
        .timestamp {
            background-color: rgba(46, 125, 50, 0.1);
            color: var(--primary);
            padding: 0 0.3rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        footer {
            background-color: var(--text-dark);
            color: var(--text-light);
            padding: 1.5rem;
            text-align: center;
            margin-top: auto;
        }
        
        footer p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem; /* Space between icons */
            justify-content: center; /* Centers the icons horizontally */
        }

        .footer-links a {
            color: var(--text-light); /* Use light color for dark background */
            text-decoration: none;
            font-size: 1.5rem; /* Make icons a bit larger */
            opacity: 0.7; /* Slightly dimmed */
            transition: var(--transition);
        }

        .footer-links a:hover {
            opacity: 1; /* Full opacity on hover */
            transform: scale(1.1); /* Slight zoom effect */
        }
        
        @media (max-width: 768px) {
            .hero {
                padding: 1.5rem 0;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .container {
                transform: translateY(-1.5rem);
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .result-content {
                min-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>VoxLogAI</h1>
        <p>Transcribe audio, videos & extract text from images and PDFs with AI.</p>
    </div>
    
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 id="card-title"><i class="fas fa-microphone-alt"></i> Audio Transcriber</h2>
            </div>
            <div class="card-body">
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <div class="mode-option active" data-mode="audio-video">
                        <i class="fas fa-headphones"></i> Audio/Video Transcription
                    </div>
                    <div class="mode-option" data-mode="document-ocr">
                        <i class="fas fa-file-alt"></i> Text from Image/PDF
                    </div>
                </div>

                <div class="tabs">
                    <!-- Audio/Video Tabs -->
                    <div class="tab-header audio-video-tabs">
                        <div class="tab active" data-tab="upload-tab">
                            <i class="fas fa-file-audio"></i> Upload Audio
                        </div>
                        <div class="tab" data-tab="youtube-tab">
                            <i class="fab fa-youtube"></i> YouTube URL
                        </div>
                    </div>
                    
                    <!-- OCR Tabs -->
                    <div class="tab-header document-ocr-tabs hidden">
                        <div class="tab active" data-tab="image-tab">
                            <i class="fas fa-file-image"></i> Upload Image
                        </div>
                        <div class="tab" data-tab="pdf-tab">
                            <i class="fas fa-file-pdf"></i> Upload PDF
                        </div>
                    </div>
                    
                    <div class="tab-content">
                        <!-- Audio/Video Content -->
                        <div class="tab-pane active" id="upload-tab">
                            <div id="upload-zone" class="upload-zone" onclick="document.getElementById('audio-file').click()">
                                <input type="file" id="audio-file" accept="audio/wav,audio/mpeg,audio/x-aiff,.aiff,audio/aac,audio/ogg,audio/flac,.mp3,.wav,.aac,.ogg,.flac" class="hidden" />
                                
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                
                                <div class="upload-text">
                                    <h3>Upload Audio File</h3>
                                    <p>Click or drag and drop your audio file here</p>
                                    <p class="file-limit">Maximum file size: 15MB</p>
                                </div>
                                
                                <div class="format-badges">
                                    <span class="format-badge">WAV</span>
                                    <span class="format-badge">MP3</span>
                                    <span class="format-badge">AIFF</span>
                                    <span class="format-badge">AAC</span>
                                    <span class="format-badge">OGG</span>
                                    <span class="format-badge">FLAC</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="youtube-tab">
                            <div class="youtube-input-container">
                                <div class="youtube-icon">
                                    <i class="fab fa-youtube"></i>
                                </div>
                                <div class="youtube-text">
                                    <h3>Transcribe from YouTube</h3>
                                    <p>Enter a YouTube video URL below</p>
                                    <p class="file-limit">Maximum audio length: ~10-15 minutes (15MB)</p>
                                    <p class="small-text">Please note that longer videos might take a while to transcribe</p>
                                </div>
                                <div class="youtube-input-wrapper">
                                    <input type="text" id="youtube-url" placeholder="https://www.youtube.com/watch?v=..." class="youtube-url-input" />
                                </div>
                            </div>
                        </div>
                        
                        <!-- OCR Content -->
                        <div class="tab-pane" id="image-tab">
                            <div id="image-upload-zone" class="image-upload-container" onclick="document.getElementById('image-file').click()">
                                <input type="file" id="image-file" accept="image/jpeg,image/png,image/webp,image/heic,image/heif,.jpg,.jpeg,.png,.webp,.heic,.heif" class="hidden" />
                                
                                <div class="image-icon">
                                    <i class="fas fa-file-image"></i>
                                </div>
                                
                                <div class="upload-text">
                                    <h3>Upload Image File</h3>
                                    <p>Click or drag and drop your image file here</p>
                                    <p class="file-limit">Maximum file size: 20MB</p>
                                </div>
                                
                                <div class="format-badges">
                                    <span class="format-badge">JPG</span>
                                    <span class="format-badge">PNG</span>
                                    <span class="format-badge">WEBP</span>
                                    <span class="format-badge">HEIC</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="pdf-tab">
                            <div id="pdf-upload-zone" class="pdf-upload-container" onclick="document.getElementById('pdf-file').click()">
                                <input type="file" id="pdf-file" accept="application/pdf,.pdf" class="hidden" />
                                
                                <div class="pdf-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                
                                <div class="upload-text">
                                    <h3>Upload PDF File</h3>
                                    <p>Click or drag and drop your PDF file here</p>
                                    <p class="file-limit">Maximum file size: 20MB</p>
                                </div>
                                
                                <div class="format-badges">
                                    <span class="format-badge">PDF</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- File Info Elements -->
                <div id="file-info" class="file-info hidden">
                    <i class="fas fa-file-audio"></i>
                    <span id="file-name"></span>
                </div>
                
                <div id="youtube-info" class="file-info hidden">
                    <i class="fab fa-youtube"></i>
                    <span id="youtube-title">YouTube URL ready for transcription</span>
                </div>
                
                <div id="image-info" class="file-info hidden">
                    <i class="fas fa-file-image"></i>
                    <span id="image-name"></span>
                </div>
                
                <div id="pdf-info" class="file-info hidden">
                    <i class="fas fa-file-pdf"></i>
                    <span id="pdf-name"></span>
                </div>
                
                <div class="options-container" id="timestamp-container">
                    <label class="toggle-option">
                        <input type="checkbox" id="timestamp-toggle" checked>
                        <span class="toggle-label">Include timestamps</span>
                    </label>
                </div>
                
                <div class="buttons">
                    <button id="action-button" disabled>
                        <i class="fas fa-language"></i>
                        Transcribe
                    </button>
                </div>
                
                <div id="upload-status" class="status hidden"></div>
                <div id="error-message" class="error hidden">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="error-text"></span>
                </div>
            </div>
        </div>
        
        <div class="result-container">
            <div class="result-header">
                <h2 id="result-title"><i class="fas fa-file-alt"></i> Result</h2>
                <div class="result-actions">
                    <button id="new-button" class="action-button" title="Start new process">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button id="copy-button" class="action-button" title="Copy to clipboard" disabled>
                        <i class="fas fa-copy"></i>
                    </button>
                    <div id="result-status" class="hidden">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
            <div id="result-content" class="result-content">
                <span class="placeholder-text">No content yet. Select a file or URL and click the action button.</span>
            </div>
        </div>
    </div>
    
    <footer>
        <p>© 2025 VoxLogAI - Privacy-focused audio transcription and OCR</p>

        <div class="footer-links">
            <a href="https://github.com/antoniocascais/VoxLogAI" target="_blank" rel="noopener noreferrer" aria-label="View source code on GitHub" title="View source code on GitHub">
                <i class="fab fa-github"></i>
            </a>
            <a href="mailto:contact.voxlogai@acascais.com" aria-label="Contact via Email" title="Contact via Email">
                <i class="fas fa-envelope"></i>
            </a>
        </div>
    </footer>
    
    <script>
        // Fallback for DOMPurify if it fails to load
        if (typeof DOMPurify === 'undefined') {
            console.warn('DOMPurify not loaded, creating fallback');
            // Simple fallback that escapes HTML
            window.DOMPurify = {
                sanitize: function(html, options) {
                    // Basic HTML escaping
                    const div = document.createElement('div');
                    div.textContent = html;
                    const escaped = div.innerHTML;
                    
                    // Only keep <br> and <span class="timestamp"> elements
                    return escaped
                        .replace(/&lt;br&gt;/g, '<br>')
                        .replace(/&lt;span class="timestamp"&gt;(.*?)&lt;\/span&gt;/g, 
                                '<span class="timestamp">$1</span>');
                }
            };
        }
        
        // Set the current mode
        let currentMode = 'audio-video';
        
        // Common elements
        const actionButton = document.getElementById('action-button');
        const uploadStatus = document.getElementById('upload-status');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const resultContent = document.getElementById('result-content');
        const resultStatus = document.getElementById('result-status');
        const copyButton = document.getElementById('copy-button');
        const newButton = document.getElementById('new-button');
        const timestampToggle = document.getElementById('timestamp-toggle');
        const timestampContainer = document.getElementById('timestamp-container');
        const cardTitle = document.getElementById('card-title');
        const resultTitle = document.getElementById('result-title');
        
        // Audio/Video elements
        const audioFileInput = document.getElementById('audio-file');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const youtubeUrlInput = document.getElementById('youtube-url');
        const youtubeInfo = document.getElementById('youtube-info');
        const youtubeTitle = document.getElementById('youtube-title');
        const uploadZone = document.getElementById('upload-zone');
        
        // OCR elements
        const imageFileInput = document.getElementById('image-file');
        const imageInfo = document.getElementById('image-info');
        const imageName = document.getElementById('image-name');
        const imageUploadZone = document.getElementById('image-upload-zone');
        
        const pdfFileInput = document.getElementById('pdf-file');
        const pdfInfo = document.getElementById('pdf-info');
        const pdfName = document.getElementById('pdf-name');
        const pdfUploadZone = document.getElementById('pdf-upload-zone');
        
        // Mode selector and tabs
        const modeOptions = document.querySelectorAll('.mode-option');
        const audioVideoTabs = document.querySelector('.audio-video-tabs');
        const documentOcrTabs = document.querySelector('.document-ocr-tabs');
        
        // Helper function to prevent defaults for drag and drop
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        // Helper function to set up drag and drop for an element
        function setupDragAndDrop(dropZone, fileInput, highlightColor, borderColor) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.style.backgroundColor = highlightColor;
                    dropZone.style.borderColor = borderColor;
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.style.backgroundColor = '';
                    dropZone.style.borderColor = '';
                }, false);
            });
            
            dropZone.addEventListener('drop', e => {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length) {
                    fileInput.files = files;
                    // Trigger the change event
                    const event = new Event('change');
                    fileInput.dispatchEvent(event);
                }
            }, false);
        }
        
        // Helper function for handling file selection
        function handleFileSelection(file, infoElement, nameElement, maxSizeMB, errorMessages = {}) {
            if (!file) return false;
            
            // Set default error messages if not provided
            const messages = {
                tooLarge: `File too large. Maximum size is ${maxSizeMB}MB. Your file is ${formatFileSize(file.size)}.`,
                placeholder: `No result yet. Click "${currentMode === 'audio-video' ? 'Transcribe' : 'Extract Text'}" to process your file.`,
                ...errorMessages
            };
            
            // Check file size
            const MAX_FILE_SIZE = maxSizeMB * 1024 * 1024; // Convert MB to bytes
            
            if (file.size > MAX_FILE_SIZE) {
                nameElement.textContent = `${file.name} (${formatFileSize(file.size)})`;
                infoElement.classList.remove('hidden');
                actionButton.disabled = true;
                
                errorText.textContent = messages.tooLarge;
                errorMessage.classList.remove('hidden');
                return false;
            }
            
            nameElement.textContent = `${file.name} (${formatFileSize(file.size)})`;
            infoElement.classList.remove('hidden');
            actionButton.disabled = false;
            
            // Reset previous state
            errorMessage.classList.add('hidden');
            resultContent.innerHTML = `<span class="placeholder-text">${messages.placeholder}</span>`;
            resultStatus.classList.add('hidden');
            
            return true;
        }
        
        // Setup drag and drop for all upload zones
        setupDragAndDrop(uploadZone, audioFileInput, 'rgba(96, 173, 94, 0.2)', '#2e7d32');
        setupDragAndDrop(imageUploadZone, imageFileInput, 'rgba(0, 128, 128, 0.1)', 'teal');
        setupDragAndDrop(pdfUploadZone, pdfFileInput, 'rgba(220, 53, 69, 0.1)', '#dc3545');
        
        // Handle file selection events
        audioFileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            handleFileSelection(file, fileInfo, fileName, 15, {
                placeholder: 'No transcript yet. Click "Transcribe" to process your audio.'
            });
        });
        
        imageFileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            handleFileSelection(file, imageInfo, imageName, 20, {
                placeholder: 'No result yet. Click "Extract Text" to process your image.'
            });
        });
        
        pdfFileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            handleFileSelection(file, pdfInfo, pdfName, 20, {
                placeholder: 'No result yet. Click "Extract Text" to process your PDF.'
            });
        });
        
        // Improved tab switching functionality
        function setupTabNavigation(tabHeader) {
            const tabs = tabHeader.querySelectorAll('.tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Only handle tabs within this tab header
                    const siblingTabs = Array.from(tabHeader.querySelectorAll('.tab'));
                    
                    // Remove active class from sibling tabs
                    siblingTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all tab panes
                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                    
                    // Show the corresponding tab pane
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Reset UI state when switching tabs
                    resetUIState();
                    
                    // Enable or disable action button based on active tab and current mode
                    updateActionButtonState(tabId);
                });
            });
        }
        
        // Setup tab navigation for both tab headers
        setupTabNavigation(audioVideoTabs);
        setupTabNavigation(documentOcrTabs);
        
        // Function to update action button state based on active tab
        function updateActionButtonState(tabId) {
            if (tabId === 'youtube-tab') {
                actionButton.disabled = !youtubeUrlInput.value.trim();
                fileInfo.classList.add('hidden');
                if (youtubeUrlInput.value.trim()) {
                    youtubeInfo.classList.remove('hidden');
                }
            } else if (tabId === 'upload-tab') {
                actionButton.disabled = !audioFileInput.files.length;
                youtubeInfo.classList.add('hidden');
            } else if (tabId === 'image-tab') {
                actionButton.disabled = !imageFileInput.files.length;
                pdfInfo.classList.add('hidden');
            } else if (tabId === 'pdf-tab') {
                actionButton.disabled = !pdfFileInput.files.length;
                imageInfo.classList.add('hidden');
            }
        }
        
        // Handle YouTube URL input
        youtubeUrlInput.addEventListener('input', function() {
            const youtubeUrl = this.value.trim();
            
            // Simple YouTube URL validation
            const youtubePattern = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[a-zA-Z0-9_-]{11}.*$/;
            const isValidUrl = youtubePattern.test(youtubeUrl);
            
            if (isValidUrl) {
                youtubeInfo.classList.remove('hidden');
                actionButton.disabled = false;
                errorMessage.classList.add('hidden');
            } else {
                youtubeInfo.classList.add('hidden');
                actionButton.disabled = !youtubeUrl;
                
                if (youtubeUrl && !isValidUrl) {
                    errorText.textContent = 'Invalid YouTube URL format. Use https://youtube.com/watch?v=... or https://youtu.be/...';
                    errorMessage.classList.remove('hidden');
                } else {
                    errorMessage.classList.add('hidden');
                }
            }
        });
        
        // Handle action button click (transcription or OCR)
        actionButton.addEventListener('click', async function() {
            // Reset UI state
            actionButton.disabled = true;
            errorMessage.classList.add('hidden');
            
            // Check the current mode and active tab
            let activeTabHeader = currentMode === 'audio-video' ? audioVideoTabs : documentOcrTabs;
            const activeTab = activeTabHeader.querySelector('.tab.active').getAttribute('data-tab');
            
            // Handle based on current mode
            if (currentMode === 'audio-video') {
                const isYoutubeMode = activeTab === 'youtube-tab';
                
                if (isYoutubeMode) {
                    // YouTube URL transcription
                    const youtubeUrl = youtubeUrlInput.value.trim();
                    if (!youtubeUrl) return;
                    
                    // Prepare UI for transcription
                    actionButton.innerHTML = '<span class="spinner"></span> Processing...';
                    uploadStatus.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Fetching YouTube audio...';
                    uploadStatus.classList.remove('hidden');
                    
                    try {
                        // Call YouTube transcription endpoint
                        const transcribeResponse = await fetch('/transcribe_youtube', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ 
                                youtube_url: youtubeUrl,
                                include_timestamps: timestampToggle.checked 
                            })
                        });
                        
                        const transcribeData = await transcribeResponse.json();
                        
                        if (transcribeResponse.ok) {
                            // Format transcript with timestamps and line breaks
                            const formattedHtml = formatTranscript(transcribeData.transcript);
                            
                            // Sanitize HTML before inserting into DOM
                            const sanitizedHtml = DOMPurify.sanitize(formattedHtml, { 
                                USE_PROFILES: { html: true }, 
                                ALLOWED_TAGS: ['br', 'span'], 
                                ALLOWED_ATTR: ['class'] 
                            });
                            
                            resultContent.innerHTML = sanitizedHtml;
                            uploadStatus.innerHTML = '<i class="fas fa-check-circle"></i> Transcription complete!';
                            actionButton.innerHTML = '<i class="fas fa-check"></i> Transcribed';
                            resultStatus.classList.remove('hidden');
                            copyButton.disabled = false;
                            
                            // Update YouTube title if available - sanitize title as well
                            if (transcribeData.title) {
                                youtubeTitle.textContent = transcribeData.title;
                            }
                        } else {
                            throw new Error(transcribeData.error || 'Transcription failed');
                        }
                    } catch (error) {
                        uploadStatus.classList.add('hidden');
                        errorText.textContent = error.message;
                        errorMessage.classList.remove('hidden');
                        actionButton.innerHTML = '<i class="fas fa-language"></i> Transcribe';
                        actionButton.disabled = false;
                    }
                } else {
                    // Audio file upload transcription
                    const file = audioFileInput.files[0];
                    if (!file) return;
                    
                    // Step 1: Upload file
                    actionButton.innerHTML = '<span class="spinner"></span> Uploading...';
                    uploadStatus.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Uploading file...';
                    uploadStatus.classList.remove('hidden');
                    
                    const formData = new FormData();
                    formData.append('audio', file);
                    
                    try {
                        // Step 1: Upload file
                        const uploadResponse = await fetch('/upload', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const uploadData = await uploadResponse.json();
                        
                        if (!uploadResponse.ok) {
                            throw new Error(uploadData.error || 'Upload failed');
                        }
                        
                        const fileId = uploadData.file_id;
                        
                        // Step 2: Transcribe file
                        uploadStatus.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Transcribing audio...';
                        actionButton.innerHTML = '<span class="spinner"></span> Transcribing...';
                        
                        const transcribeResponse = await fetch('/transcribe', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ 
                                file_id: fileId,
                                include_timestamps: timestampToggle.checked 
                            })
                        });
                        
                        const transcribeData = await transcribeResponse.json();
                        
                        if (transcribeResponse.ok) {
                            // Format transcript with timestamps and line breaks
                            const formattedHtml = formatTranscript(transcribeData.transcript);
                            
                            // Sanitize HTML before inserting into DOM
                            const sanitizedHtml = DOMPurify.sanitize(formattedHtml, { 
                                USE_PROFILES: { html: true }, 
                                ALLOWED_TAGS: ['br', 'span'], 
                                ALLOWED_ATTR: ['class'] 
                            });
                            
                            resultContent.innerHTML = sanitizedHtml;
                            uploadStatus.innerHTML = '<i class="fas fa-check-circle"></i> Transcription complete!';
                            actionButton.innerHTML = '<i class="fas fa-check"></i> Transcribed';
                            resultStatus.classList.remove('hidden');
                            copyButton.disabled = false;
                        } else {
                            throw new Error(transcribeData.error || 'Transcription failed');
                        }
                    } catch (error) {
                        uploadStatus.classList.add('hidden');
                        errorText.textContent = error.message;
                        errorMessage.classList.remove('hidden');
                        actionButton.innerHTML = '<i class="fas fa-language"></i> Transcribe';
                        actionButton.disabled = false;
                    }
                }
            } else if (currentMode === 'document-ocr') {
                const isImageMode = activeTab === 'image-tab';
                
                if (isImageMode) {
                    // Process image OCR
                    const file = imageFileInput.files[0];
                    if (!file) return;
                    
                    // Prepare UI for OCR
                    actionButton.innerHTML = '<span class="spinner"></span> Processing...';
                    uploadStatus.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processing image...';
                    uploadStatus.classList.remove('hidden');
                    
                    const formData = new FormData();
                    formData.append('image', file);
                    
                    try {
                        const ocrResponse = await fetch('/ocr_image', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const ocrData = await ocrResponse.json();
                        
                        if (ocrResponse.ok) {
                            // Format the OCR text
                            const formattedText = ocrData.text.replace(/\n/g, '<br>');
                            
                            // Sanitize HTML before inserting into DOM
                            const sanitizedHtml = DOMPurify.sanitize(formattedText, { 
                                USE_PROFILES: { html: true }, 
                                ALLOWED_TAGS: ['br'] 
                            });
                            
                            resultContent.innerHTML = sanitizedHtml;
                            uploadStatus.innerHTML = '<i class="fas fa-check-circle"></i> Text extraction complete!';
                            actionButton.innerHTML = '<i class="fas fa-check"></i> Extracted';
                            resultStatus.classList.remove('hidden');
                            copyButton.disabled = false;
                        } else {
                            throw new Error(ocrData.error || 'OCR processing failed');
                        }
                    } catch (error) {
                        uploadStatus.classList.add('hidden');
                        errorText.textContent = error.message;
                        errorMessage.classList.remove('hidden');
                        actionButton.innerHTML = '<i class="fas fa-file-alt"></i> Extract Text';
                        actionButton.disabled = false;
                    }
                } else {
                    // Process PDF OCR
                    const file = pdfFileInput.files[0];
                    if (!file) return;
                    
                    // Prepare UI for OCR
                    actionButton.innerHTML = '<span class="spinner"></span> Processing...';
                    uploadStatus.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processing PDF...';
                    uploadStatus.classList.remove('hidden');
                    
                    const formData = new FormData();
                    formData.append('pdf', file);
                    
                    try {
                        const ocrResponse = await fetch('/ocr_pdf', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const ocrData = await ocrResponse.json();
                        
                        if (ocrResponse.ok) {
                            // Format the OCR text
                            const formattedText = ocrData.text.replace(/\n/g, '<br>');
                            
                            // Sanitize HTML before inserting into DOM
                            const sanitizedHtml = DOMPurify.sanitize(formattedText, { 
                                USE_PROFILES: { html: true }, 
                                ALLOWED_TAGS: ['br'] 
                            });
                            
                            resultContent.innerHTML = sanitizedHtml;
                            uploadStatus.innerHTML = '<i class="fas fa-check-circle"></i> Text extraction complete!';
                            actionButton.innerHTML = '<i class="fas fa-check"></i> Extracted';
                            resultStatus.classList.remove('hidden');
                            copyButton.disabled = false;
                        } else {
                            throw new Error(ocrData.error || 'PDF processing failed');
                        }
                    } catch (error) {
                        uploadStatus.classList.add('hidden');
                        errorText.textContent = error.message;
                        errorMessage.classList.remove('hidden');
                        actionButton.innerHTML = '<i class="fas fa-file-alt"></i> Extract Text';
                        actionButton.disabled = false;
                    }
                }
            }
        });
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        // Format transcript with line breaks and timestamp formatting
        function formatTranscript(text) {
            let formattedText = text;
            
            // Format timestamps like [8m40s242ms - 8m51s12ms] if timestamps are enabled
            if (timestampToggle.checked) {
                formattedText = text.replace(/\[(\d+m\d+s\d+ms\s*-\s*\d+m\d+s\d+ms)\]/g, 
                                         '<span class="timestamp">[$1]</span>');
            }
            
            // Replace new lines with <br> tags
            return formattedText.replace(/\n/g, '<br>');
        }
        
        // Copy result to clipboard
        copyButton.addEventListener('click', function() {
            // Get the text content without HTML tags
            const resultText = resultContent.innerText;
            
            // Check if there's actual content to copy
            if (resultText && !resultText.includes('No content yet')) {
                navigator.clipboard.writeText(resultText).then(function() {
                    // Show copied message
                    const tooltip = document.createElement('span');
                    tooltip.className = 'copied-tooltip';
                    tooltip.textContent = 'Copied!';
                    
                    // Position the tooltip relative to the button
                    copyButton.style.position = 'relative';
                    copyButton.appendChild(tooltip);
                    
                    // Remove tooltip after animation completes
                    setTimeout(function() {
                        copyButton.removeChild(tooltip);
                    }, 1500);
                }).catch(function(err) {
                    console.error('Could not copy text: ', err);
                });
            }
        });
        
        // Handle timestamp toggle
        timestampToggle.addEventListener('change', function() {
            // If transcript already exists, reformat it
            if (resultContent.innerHTML && !resultContent.innerHTML.includes('placeholder-text')) {
                const currentText = resultContent.innerText;
                // On toggle change, we need to re-apply formatting to show/hide timestamps
                const formattedHtml = formatTranscript(currentText);
                
                // Sanitize HTML before inserting into DOM
                const sanitizedHtml = DOMPurify.sanitize(formattedHtml, { 
                    USE_PROFILES: { html: true }, 
                    ALLOWED_TAGS: ['br', 'span'], 
                    ALLOWED_ATTR: ['class'] 
                });
                
                resultContent.innerHTML = sanitizedHtml;
            }
        });
        
        // Handle new button click
        newButton.addEventListener('click', resetUIState);
        
        // Mode switching
        modeOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Remove active class from all options
                modeOptions.forEach(opt => opt.classList.remove('active'));
                
                // Add active class to clicked option
                option.classList.add('active');
                
                // Get the mode
                const mode = option.getAttribute('data-mode');
                currentMode = mode;
                
                // Update UI based on mode
                if (mode === 'audio-video') {
                    cardTitle.innerHTML = '<i class="fas fa-microphone-alt"></i> Audio Transcriber';
                    audioVideoTabs.classList.remove('hidden');
                    documentOcrTabs.classList.add('hidden');
                    timestampContainer.classList.remove('hidden');
                    actionButton.innerHTML = '<i class="fas fa-language"></i> Transcribe';
                    
                    // Always show the first tab in audio-video mode when switching modes
                    // This ensures we reset to audio upload tab when coming from PDF tab
                    audioVideoTabs.querySelectorAll('.tab').forEach((tab, index) => {
                        if (index === 0) {
                            tab.classList.add('active');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                    
                    // Show the upload-tab pane
                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                    document.getElementById('upload-tab').classList.add('active');
                } else if (mode === 'document-ocr') {
                    cardTitle.innerHTML = '<i class="fas fa-file-alt"></i> Text from Image/PDF';
                    audioVideoTabs.classList.add('hidden');
                    documentOcrTabs.classList.remove('hidden');
                    timestampContainer.classList.add('hidden');
                    actionButton.innerHTML = '<i class="fas fa-file-alt"></i> Extract Text';
                    
                    // Always show the first tab in document-ocr mode when switching modes
                    documentOcrTabs.querySelectorAll('.tab').forEach((tab, index) => {
                        if (index === 0) {
                            tab.classList.add('active');
                        } else {
                            tab.classList.remove('active');
                        }
                    });
                    
                    // Show the image-tab pane
                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                    document.getElementById('image-tab').classList.add('active');
                }
                
                // Reset other UI elements
                resetUIState();
            });
        });
        
        // Function to reset UI to initial state
        function resetUIState() {
            // Reset file inputs
            audioFileInput.value = '';
            imageFileInput.value = '';
            pdfFileInput.value = '';
            
            // Don't reset youtubeUrlInput.value to preserve user input when switching tabs
            
            // Reset UI elements
            fileInfo.classList.add('hidden');
            youtubeInfo.classList.add('hidden');
            imageInfo.classList.add('hidden');
            pdfInfo.classList.add('hidden');
            uploadStatus.classList.add('hidden');
            errorMessage.classList.add('hidden');
            resultStatus.classList.add('hidden');
            
            // Reset buttons
            actionButton.disabled = true;
            if (currentMode === 'audio-video') {
                actionButton.innerHTML = '<i class="fas fa-language"></i> Transcribe';
            } else {
                actionButton.innerHTML = '<i class="fas fa-file-alt"></i> Extract Text';
            }
            copyButton.disabled = true;
            
            // Reset result content
            const placeholderText = currentMode === 'audio-video' 
                ? 'No transcript yet. Select an audio file or enter a YouTube URL and click "Transcribe".'
                : 'No result yet. Select an image or PDF file and click "Extract Text".';
            resultContent.innerHTML = `<span class="placeholder-text">${placeholderText}</span>`;
            
            // Check current tab and re-enable button if needed based on mode
            if (currentMode === 'audio-video') {
                const activeTab = audioVideoTabs.querySelector('.tab.active').getAttribute('data-tab');
                if (activeTab === 'youtube-tab' && youtubeUrlInput.value.trim()) {
                    actionButton.disabled = false;
                    youtubeInfo.classList.remove('hidden');
                } else if (activeTab === 'upload-tab' && audioFileInput.files.length) {
                    actionButton.disabled = false;
                    fileInfo.classList.remove('hidden');
                }
            } else {
                const activeTab = documentOcrTabs.querySelector('.tab.active').getAttribute('data-tab');
                if (activeTab === 'image-tab' && imageFileInput.files.length) {
                    actionButton.disabled = false;
                    imageInfo.classList.remove('hidden');
                } else if (activeTab === 'pdf-tab' && pdfFileInput.files.length) {
                    actionButton.disabled = false;
                    pdfInfo.classList.remove('hidden');
                }
            }
        }
    </script>
</body>
</html>
